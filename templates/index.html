<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Orange QoD API Tester</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="{{ url_for('static', path='/css/style.css') }}" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1 class="text-center mb-4">Orange QoD API Tester</h1>

        <div id="tokenStatusBox" class="alert alert-info mb-4">
          Checking token status...
        </div>

        {% if not api_token_configured %}
        <div class="alert alert-warning mb-4">
            <h4 class="alert-heading">⚠️ API Token Not Configured</h4>
            <p>The API token is required to make requests to the Orange QoD API. Please follow these steps to configure it:</p>
            <ol>
                <li>Create a <code>.env</code> file in the root directory if it doesn't exist</li>
                <li>Add your API token to the <code>.env</code> file like this: <code>API_TOKEN=your_token_here</code></li>
                <li>Restart the application</li>
            </ol>
            <hr>
            <p class="mb-0">Once configured, you'll be able to create and manage QoS sessions.</p>
        </div>
        {% endif %}
        
        <!-- QoS Profiles Dropdown Section -->
        <h2>Available QoS Profiles</h2>
        <select id="qosProfilesDropdown">
          <option>Loading...</option>
        </select>

        <script>
        async function loadQosProfiles() {
          const response = await fetch('/qos/profiles');
          const data = await response.json();
          const dropdown = document.getElementById('qosProfilesDropdown');
          dropdown.innerHTML = '';
          if (data.profiles && Array.isArray(data.profiles)) {
            data.profiles.forEach(profile => {
              const option = document.createElement('option');
              option.value = profile.name;
              option.text = profile.name + (profile.description ? ' - ' + profile.description : '');
              dropdown.appendChild(option);
            });
          } else {
            dropdown.innerHTML = '<option>No profiles found</option>';
          }
        }

        async function checkTokenStatus() {
          const box = document.getElementById('tokenStatusBox');
          try {
            const response = await fetch('/token/status');
            const data = await response.json();
            if (data.status === "granted") {
              box.className = "alert alert-success mb-4";
              box.textContent = data.message;
            } else {
              box.className = "alert alert-danger mb-4";
              box.textContent = "Token error: " + data.message;
            }
          } catch (e) {
            box.className = "alert alert-danger mb-4";
            box.textContent = "Could not check token status.";
          }
        }

        window.onload = function() {
          loadQosProfiles();
          checkTokenStatus();
        };
        </script>
        <!-- End QoS Profiles Dropdown Section -->

        <!-- Create QoS Session -->
        <div class="card mb-4">
            <div class="card-header">
                <h3>Create QoS Session</h3>
            </div>
            <div class="card-body">
                <form id="createSessionForm">
                    <!-- Basic Settings -->
                    <div class="mb-3">
                        <label for="duration" class="form-label">Duration (seconds)</label>
                        <input type="number" class="form-control" id="duration" name="duration" required min="1" value="86400">
                    </div>
                    <div class="mb-3">
                        <label for="qos_profile" class="form-label">QoS Profile</label>
                        <input type="text" class="form-control" id="qos_profile" name="qos_profile" required value="QCI_1_voice">
                    </div>

                    <!-- Device Information -->
                    <div class="card mb-3">
                        <div class="card-header">Device Information</div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label for="phone_number" class="form-label">Phone Number</label>
                                <input type="text" class="form-control" id="phone_number" name="phone_number">
                            </div>
                            <div class="mb-3">
                                <label for="network_access_identifier" class="form-label">Network Access Identifier</label>
                                <input type="text" class="form-control" id="network_access_identifier" name="network_access_identifier">
                            </div>
                            <div class="mb-3">
                                <label for="device_ipv4_public_address" class="form-label">IPv4 Public Address</label>
                                <input type="text" class="form-control" id="device_ipv4_public_address" name="device_ipv4_public_address" required>
                            </div>
                            <div class="mb-3">
                                <label for="device_ipv4_private_address" class="form-label">IPv4 Private Address</label>
                                <input type="text" class="form-control" id="device_ipv4_private_address" name="device_ipv4_private_address" required>
                            </div>
                            <div class="mb-3">
                                <label for="device_ipv4_port" class="form-label">IPv4 Public Port</label>
                                <input type="number" class="form-control" id="device_ipv4_port" name="device_ipv4_port">
                            </div>
                            <div class="mb-3">
                                <label for="device_ipv6_address" class="form-label">IPv6 Address</label>
                                <input type="text" class="form-control" id="device_ipv6_address" name="device_ipv6_address">
                            </div>
                        </div>
                    </div>

                    <!-- Application Server -->
                    <div class="card mb-3">
                        <div class="card-header">Application Server</div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label for="server_ipv4_address" class="form-label">IPv4 Address</label>
                                <input type="text" class="form-control" id="server_ipv4_address" name="server_ipv4_address">
                            </div>
                            <div class="mb-3">
                                <label for="server_ipv6_address" class="form-label">IPv6 Address</label>
                                <input type="text" class="form-control" id="server_ipv6_address" name="server_ipv6_address">
                            </div>
                        </div>
                    </div>

                    <!-- Device Ports -->
                    <div class="card mb-3">
                        <div class="card-header">Device Ports</div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label for="device_port_range_from" class="form-label">Port Range From</label>
                                <input type="number" class="form-control" id="device_port_range_from" name="device_port_range_from">
                            </div>
                            <div class="mb-3">
                                <label for="device_port_range_to" class="form-label">Port Range To</label>
                                <input type="number" class="form-control" id="device_port_range_to" name="device_port_range_to">
                            </div>
                            <div class="mb-3">
                                <label for="device_ports" class="form-label">Individual Ports (comma-separated)</label>
                                <input type="text" class="form-control" id="device_ports" name="device_ports" placeholder="e.g., 5060,5070">
                            </div>
                        </div>
                    </div>

                    <!-- Application Server Ports -->
                    <div class="card mb-3">
                        <div class="card-header">Application Server Ports</div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label for="server_port_range_from" class="form-label">Port Range From</label>
                                <input type="number" class="form-control" id="server_port_range_from" name="server_port_range_from">
                            </div>
                            <div class="mb-3">
                                <label for="server_port_range_to" class="form-label">Port Range To</label>
                                <input type="number" class="form-control" id="server_port_range_to" name="server_port_range_to">
                            </div>
                            <div class="mb-3">
                                <label for="server_ports" class="form-label">Individual Ports (comma-separated)</label>
                                <input type="text" class="form-control" id="server_ports" name="server_ports" placeholder="e.g., 5060,5070">
                            </div>
                        </div>
                    </div>

                    <!-- Webhook Information -->
                    <div class="card mb-3">
                        <div class="card-header">Webhook Information</div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label for="notification_url" class="form-label">Notification URL</label>
                                <input type="url" class="form-control" id="notification_url" name="notification_url">
                            </div>
                            <div class="mb-3">
                                <label for="notification_auth_token" class="form-label">Notification Auth Token</label>
                                <input type="text" class="form-control" id="notification_auth_token" name="notification_auth_token">
                            </div>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary">Create Session</button>
                </form>
            </div>
        </div>

        <!-- Get Session Status -->
        <div class="card mb-4">
            <div class="card-header">
                <h3>Get Session Status</h3>
            </div>
            <div class="card-body">
                <form id="getSessionForm">
                    <div class="mb-3">
                        <label for="session_id_get" class="form-label">Session ID</label>
                        <input type="text" class="form-control" id="session_id_get" required>
                    </div>
                    <button type="submit" class="btn btn-info">Get Status</button>
                </form>
            </div>
        </div>

        <!-- Delete Session -->
        <div class="card mb-4">
            <div class="card-header">
                <h3>Delete Session</h3>
            </div>
            <div class="card-body">
                <form id="deleteSessionForm">
                    <div class="mb-3">
                        <label for="session_id_delete" class="form-label">Session ID</label>
                        <input type="text" class="form-control" id="session_id_delete" required>
                    </div>
                    <button type="submit" class="btn btn-danger">Delete Session</button>
                </form>
            </div>
        </div>

        <!-- Response Display -->
        <div class="card">
            <div class="card-header">
                <h3>API Response</h3>
            </div>
            <div class="card-body">
                <pre id="responseDisplay" class="bg-light p-3 rounded">No response yet</pre>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', path='/js/main.js') }}"></script>
    <script>
    document.getElementById('device_ipv4_public_address').addEventListener('input', function() {
        document.getElementById('device_ipv4_private_address').value = this.value;
    });
    document.getElementById('device_ipv4_private_address').addEventListener('input', function() {
        document.getElementById('device_ipv4_public_address').value = this.value;
    });
    </script>
</body>
</html> 